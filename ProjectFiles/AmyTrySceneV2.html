<!DOCTYPE html>

<html>
<head>
    <title>Our 3D creation</title>

    <!-- This is the CSS style of this page. -->
    <link rel="stylesheet" href="stylesheet.css" type="text/css">

    <meta http-equiv="Content-type" content="text/html; charset=UTF-8" />

    <!--include the sql.js library-->
    <script type="text/javascript" src="js/sql.js"></script>

    <!--include the three.js library-->
    <script src="js/three.js"></script>
    <!--and the trackball code-->
    <script src="js/OrbitControls.js"></script>
    <!--include the dat.gui.min.js library to edit the scene in real time-->
    <script src="js/dat.gui.min.js"></script>
    <!--include the stats.js library-->
    <script src="js/stats.js"></script>

    <script src="js/PLYLoader.js"></script>

    <script src="js/jquery.min.js"></script>

</head>


<body>

    <!-- This div element is the top text space on the page. -->
    <div id="info">
        <p>
            This is a Grid test experimented by Amy. Click your mouse to start moving the box!
            <br />
            left   click to rotate, middle click to zoom,  right  click to pan

        </p>

    </div>

    
        <!-- Control panel to interact with the scene -->
    <div id="controls">
        Control Panel
        <br />

        - Move the box
        <div id="camera-position">
            <button id="up">up (W)</button>
            <br />
            <button id="forward">forward (R)</button>
            <br />
            <button id="left">left (A)</button> MOVE BOX <button id="right">right (D)</button>
            <br />
            <button id="backward">backward (F)</button>
            <br />
            <button id="down">down (S)</button>
            <br />
            <br />

        </div>
        <button id="set-box">Set block here!<br />(Enter)</button>

        <hr />
        - Undone -
        <br />

        <button id="hide">Hide Block</button>
        <button id="undo">Undo</button>
        <button id="redo">Redo</button>
        <button>Control button</button>
        <button>Control button</button>


    </div>
    <!-- This script section is where we add THREE.JS code. -->
    <script>
        //create the scene and camera
        var scene = new THREE.Scene();

        // Monitor the performance.
        var stats = new Stats();
        document.body.appendChild(stats.dom);

        // Create interaction control panel.
        var gui = new dat.GUI();

        var ratio = window.innerWidth / window.innerHeight;
        var camera = new THREE.PerspectiveCamera(45, ratio, 1, 1000);
        // Place the camera (at the coordinate of its neareast parent.)
        camera.position.set(12, 18, 28);
        // Determine which point the camera is looking at.
        camera.lookAt(0, 0, 0);

        scene.add(camera);

        


    </script>

    <!-- This script section is the function to create and to update the renderer. -->
    <script src="scripts/UpdateRenderer.js"></script>

    <!-- This script section stores the functions about creating objects. -->
    <script src="scripts/CreateObjectsNew.js"></script>
    <script src="scripts/Collections.js"></script>
    <script src="scripts/ObjectsCreation.js"></script>

    <!-- This script section stores the functions about controlling the box with your keyboard. -->
    <script src="scripts/KeyboardOperation.js"></script>


    <!-- This script section is where we add THREE.JS code. -->
    <script>

        // Use the clock to calculate time elapse.
        var clock = new THREE.Clock();

        // Change the color of the background to grey.
        renderer.setClearColor(0x555555);


        // Create a plane to see the grid. Always use odd number, ohterwise the position is not accurate.

        var ground = getPlane(101);
        ground.position.y = -0.50;
        ground.material.color.setHex(0x88aa88);
        scene.add(ground);

        

        // Used to update block color
        var Color = function (object) {
            this.color = 0xee6666; // RGB with alpha

            // Define render logic ...
            object.material.color.setHex(this.color);

            this.SetColor = function () {
                object.material.color.setHex(this.color);
            }
        };

        var box = getBox(0x000000);
        box.material = new THREE.MeshPhongMaterial();

        scene.add(box);

        colorChanger = new Color(box);

        gui.addColor(colorChanger, 'color');



        // Environment light
        var ambientLight = getAmbientLight(3);
        scene.add(ambientLight);

        var pointLight = getPointLight(1);
        scene.add(pointLight);


        gui.add(pointLight, 'intensity', 0.5, 5);
        gui.add(pointLight.position, 'y', 10, 30);
        gui.add(pointLight.position, 'x', -30, 30);
        gui.add(pointLight.position, 'z', -30, 30);


        var bottomBlock = getTransparentBottom();
        bottomBlock.position.y = -0.49;
        scene.add(bottomBlock);

        // Make a sphere to point out the control box.
        var ball = getCone(0.2);
        scene.add(ball);

        ball.position.x = box.position.x;
        ball.position.z = box.position.z;

        // Make buttons work.
        setButtonEvents();



        //////////////
        // CONTROLS //
        //////////////

        // move mouse and: left   click to rotate,
        //                 middle click to zoom,
        //                 right  click to pan
        // add the new control and link to the current camera to transform its position
        controls = new THREE.OrbitControls(camera, renderer.domElement);


        // Constantly update the renderer/scene.
        var MyUpdateLoop = function () {
            //call the render with the scene and the camera
            renderer.render(scene, camera);
            // Update the stats to monitor.
            stats.update();

            colorChanger.SetColor();

            // Calculate time elapsed with the clock.
            var timeElapsed = clock.getElapsedTime();

            ball.position.y = box.position.y + 2 + Math.sin(timeElapsed * 2) / 2;


            //finally perform a recursive call to update again
            //this must be called because the mouse change the camera position
            requestAnimationFrame(MyUpdateLoop);

        };

        requestAnimationFrame(MyUpdateLoop);

    </script>


</body>
</html>








